@model Cedeva.Website.Features.PublicRegistration.ViewModels.ActivityQuestionsViewModel

@{
    ViewData["Title"] = Localizer["PublicRegistration.Questions"];
    Layout = "~/Features/Shared/Layouts/_PublicLayout.cshtml";
}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0"><i class="fas fa-question-circle me-2"></i>@ViewData["Title"]</h2>
                </div>
                <div class="card-body">
                    <p class="lead mb-4">@Localizer["PublicRegistration.ActivityQuestionsLead"]</p>

                    <form asp-action="ActivityQuestions" method="post">
                        <input type="hidden" asp-for="ActivityId" />
                        <input type="hidden" asp-for="ParentId" />
                        <input type="hidden" asp-for="ChildId" />

                        @if (Model.Questions.Any())
                        {
                            <div class="row g-4">
                                @for (int i = 0; i < Model.Questions.Count; i++)
                                {
                                    var question = Model.Questions[i];
                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-body">
                                                @switch (question.QuestionType)
                                                {
                                                    case Cedeva.Core.Enums.QuestionType.Text:
                                                        var textInputId = $"text_{question.Id}";
                                                        <label class="form-label" for="@textInputId">
                                                            <strong>@question.QuestionText</strong>
                                                            @if (question.IsRequired)
                                                            {
                                                                <span class="text-danger">*</span>
                                                            }
                                                        </label>
                                                        <input type="text" name="Answers[@question.Id]" id="@textInputId" class="form-control" required="@question.IsRequired" />
                                                        break;

                                                    case Cedeva.Core.Enums.QuestionType.Checkbox:
                                                        <div class="mb-2">
                                                            <strong>@question.QuestionText</strong>
                                                            @if (question.IsRequired)
                                                            {
                                                                <span class="text-danger">*</span>
                                                            }
                                                        </div>
                                                        var checkboxOptions = question.Options?.Split(',') ?? Array.Empty<string>();
                                                        var checkboxIndex = 0;
                                                        @foreach (var option in checkboxOptions)
                                                        {
                                                            var checkboxId = $"checkbox_{question.Id}_{checkboxIndex}";
                                                            <div class="form-check">
                                                                <input type="checkbox" name="Answers[@question.Id]" value="@option.Trim()" class="form-check-input" id="@checkboxId" />
                                                                <label class="form-check-label" for="@checkboxId">
                                                                    @option.Trim()
                                                                </label>
                                                            </div>
                                                            checkboxIndex++;
                                                        }
                                                        break;

                                                    case Cedeva.Core.Enums.QuestionType.Radio:
                                                        <div class="mb-2">
                                                            <strong>@question.QuestionText</strong>
                                                            @if (question.IsRequired)
                                                            {
                                                                <span class="text-danger">*</span>
                                                            }
                                                        </div>
                                                        var radioOptions = question.Options?.Split(',') ?? Array.Empty<string>();
                                                        var radioIndex = 0;
                                                        @foreach (var option in radioOptions)
                                                        {
                                                            var radioId = $"radio_{question.Id}_{radioIndex}";
                                                            <div class="form-check">
                                                                <input type="radio" name="Answers[@question.Id]" value="@option.Trim()" class="form-check-input" id="@radioId" required="@question.IsRequired" />
                                                                <label class="form-check-label" for="@radioId">
                                                                    @option.Trim()
                                                                </label>
                                                            </div>
                                                            radioIndex++;
                                                        }
                                                        break;

                                                    case Cedeva.Core.Enums.QuestionType.Dropdown:
                                                        var dropdownInputId = $"dropdown_{question.Id}";
                                                        <label class="form-label" for="@dropdownInputId">
                                                            <strong>@question.QuestionText</strong>
                                                            @if (question.IsRequired)
                                                            {
                                                                <span class="text-danger">*</span>
                                                            }
                                                        </label>
                                                        var dropdownOptions = question.Options?.Split(',') ?? Array.Empty<string>();
                                                        <select name="Answers[@question.Id]" id="@dropdownInputId" class="form-select" required="@question.IsRequired">
                                                            <option value="">@Localizer["PublicRegistration.SelectOption"]</option>
                                                            @foreach (var option in dropdownOptions)
                                                            {
                                                                <option value="@option.Trim()">@option.Trim()</option>
                                                            }
                                                        </select>
                                                        break;
                                                }
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>

                            <div class="d-grid gap-2 mt-4">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-check me-2"></i>@Localizer["PublicRegistration.FinalizeBooking"]
                                </button>
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>@Localizer["PublicRegistration.NoQuestionsRequired"]
                            </div>
                        }
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        $(document).ready(function() {
            CedevaChoices.initAll('.form-select');
        });
    </script>
}
