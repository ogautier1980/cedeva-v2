@{
    ViewData["Title"] = Localizer["PublicRegistration.EmbedCode"];
    var activityId = ViewBag.ActivityId as int?;
    var activityName = ViewBag.ActivityName as string;
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h3 mb-2"><i class="fas fa-code me-2"></i>@ViewData["Title"]</h1>
            <p class="text-muted">@activityName</p>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-palette me-2"></i>@Localizer["PublicRegistration.Customization"]</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="bgColor" class="form-label">@Localizer["PublicRegistration.BackgroundColor"]</label>
                        <div class="input-group">
                            <span class="input-group-text">#</span>
                            <input type="text" class="form-control" id="bgColor" value="ffffff" maxlength="6" placeholder="ffffff" />
                            <input type="color" class="form-control form-control-color" id="colorPicker" value="#ffffff" title="@Localizer["PublicRegistration.ChooseColor"]" />
                        </div>
                        <small class="form-text text-muted">@Localizer["PublicRegistration.ColorHelp"]</small>
                    </div>

                    <div class="mb-3">
                        <label for="iframeHeight" class="form-label">@Localizer["PublicRegistration.Height"]</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="iframeHeight" value="1200" min="600" max="3000" />
                            <span class="input-group-text">px</span>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="updateCode()">
                        <i class="fas fa-sync me-2"></i>@Localizer["PublicRegistration.UpdateCode"]
                    </button>
                </div>
            </div>

            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-window-maximize me-2"></i>@Localizer["PublicRegistration.IntegrationCode"]</h5>
                </div>
                <div class="card-body">
                    <p>@Localizer["PublicRegistration.EmbedInstructions"]</p>

                    <div class="position-relative">
                        <pre class="bg-light p-3 border rounded"><code id="embedCode"></code></pre>
                        <button class="btn btn-sm btn-outline-primary position-absolute top-0 end-0 m-2" onclick="copyToClipboard()">
                            <i class="fas fa-copy me-2"></i>@Localizer["PublicRegistration.Copy"]
                        </button>
                    </div>

                    <div class="mt-3">
                        <label class="form-label">@Localizer["PublicRegistration.DirectLink"]</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="directLink" readonly />
                            <button class="btn btn-outline-secondary" onclick="copyLink()">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-eye me-2"></i>@Localizer["PublicRegistration.Preview"]</h5>
                </div>
                <div class="card-body p-0">
                    <iframe id="previewFrame" width="100%" height="800" style="border: 1px solid #ddd;" title="@Localizer["PublicRegistration.PreviewFrame"]"></iframe>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const activityId = @activityId;
        const baseUrl = '@(Context.Request.Scheme)://@(Context.Request.Host)';

        function updateCode() {
            const bgColor = document.getElementById('bgColor').value.replace('#', '');
            const height = document.getElementById('iframeHeight').value;
            const iframeUrl = `${baseUrl}/PublicRegistration/Register?activityId=${activityId}&bg=${bgColor}`;

            const embedCode = `<iframe src="${iframeUrl}" width="100%" height="${height}" frameborder="0" style="border: 1px solid #ddd; border-radius: 8px;"></iframe>`;

            document.getElementById('embedCode').textContent = embedCode;
            document.getElementById('directLink').value = iframeUrl;
            document.getElementById('previewFrame').src = iframeUrl;
        }

        function copyToClipboard() {
            const code = document.getElementById('embedCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('@Localizer["PublicRegistration.CopySuccess"]');
            }).catch(err => {
                console.error('@Localizer["PublicRegistration.CopyError"]', err);
            });
        }

        function copyLink() {
            const link = document.getElementById('directLink').value;
            navigator.clipboard.writeText(link).then(() => {
                alert('@Localizer["PublicRegistration.CopySuccess"]');
            }).catch(err => {
                console.error('@Localizer["PublicRegistration.CopyError"]', err);
            });
        }

        // Color picker sync
        document.getElementById('colorPicker').addEventListener('input', function() {
            document.getElementById('bgColor').value = this.value.substring(1);
        });

        document.getElementById('bgColor').addEventListener('input', function() {
            let color = this.value.replace('#', '');
            if (color.length === 6) {
                document.getElementById('colorPicker').value = '#' + color;
            }
        });

        // Initialize
        updateCode();
    </script>
}
